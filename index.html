<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="stylesheet.css" />
    <title>Banned Books</title>
</head>
<body>
    <div class="container">
        <div class="heading">
            <!--<div class="headimg"> </div>  img src="nypubliclibrarybookimg.png" style="width:110%;height:600px;"> --> 
            <h1 class="heading-text">5,813 books were challenged in the US in 2024</h1>
    
        </div>
        <div class="text-container">
            <!-- <h2 class="section-title">Story</h2> -->
             <p class="section-text">
                Over the last 5 years, book bans have become more prevalent in the United States. 
                After the COVID-19 pandemic and election of former president Biden, there was a drastic 
                increase in the numbers of books banned and challenged yearly in the US.
             </p>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Books Challenged in the Last 10 Years</h2>
            <div style="min-height:425px" id="datawrapper-vis-ULINl"><script type="text/javascript" defer src="https://datawrapper.dwcdn.net/ULINl/embed.js" charset="utf-8" data-target="#datawrapper-vis-ULINl"></script><noscript><img src="https://datawrapper.dwcdn.net/ULINl/full.png" alt="" /></noscript></div>
            <div id="datawrapper"></div>
        </div>
        <div class="text-container">
            <p class="section-text">
                Between 2015 and 2020 the number of titles challenged stayed relatively steady, 
                fluctuating between 230 and 332. But then, in 2021, the number of titles challenged 
                jumped to 3,926. This was a 1317% increase from the number of titles challenged in 2020. 
                The continued to rise and have not returned to previous levels. These numbers may seem 
                alarming but abstract, so what does this mean?
             </p>
        </div>
        <div class="context">
            <h2 class="context-title">What is a book ban?</h2>
            <p class="context-text">
                A book ban is a form of censorship. Bans aim to restrict access to books that 
                some deem inappropriate or otherwise unsuitable for audiences.
            </p>
            <h3 class="follow-up-title">What is the difference between a ban and a challenge?</h3>
            <p class="context-text">
                PEN America defines a challenge as “any attempt to restrict or remove a book based on 
                objections to its content.” A ban, however, is the actual restriction of a challenged book.
            </p>
        </div>
        <div class="text-container">
            <h2 class="section-title">So, what's happening?</h2>
            <p class="section-text">
                The influx of book challenges has lead to the removal and restriction of thousands of 
                books from various public and private spaces. In 2024 an overwhelming majority of books were 
                restricted in libraries.
             </p>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Where Books Are Banned 2024</h2>
            <div id="donut-chart"></div>
        </div>
        <div class="text-container">
            <p class="section-text">
                Libraries make up 93% of the places books were banned last year. Libraries are important
                 because they give people free access to information and resources. Not only are school libraries 
                 being targeted by these bans, restricting access to books from students, but public libraries are 
                 the most censored. 55% of the books banned in 2024 were banned in public libraries. The 
                 consequence of this is that the general public is being denied access to diverse information 
                 unless they can find somewhere to buy it. So, who is causing this?
             </p>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Who Bans Books 2024</h2>
            <div id="donut-chart2"></div>
        </div>
        <div class="text-container">
            <p class="section-text">
                Despite libraries being the primary target of these bans, librarians, teachers, and staff 
                only make up 1% of the people challenging books. 46% of these people are goverment officials 
                or board members, they are responsible for not only for challenging books but they also have 
                to power to ban them. The next largest group is parents and pressure groups, making up 42% of 
                advocates for banning books. Many of these pressure groups are conservative communities, one 
                example being parents rights groups. As the name suggests, pressure groups pressure organizations 
                (schools, libraries, etc) to restrict access to books they think are inappropriate for public spaces.
                What are they censoring? 
             </p>
        </div>
        <!-- <div class="chart-container">
            <h2 class="chart-title">Themes of Books Banned in 2022-2023</h2>
            <div id="bar-chart"></div>
        </div> -->
        <div class="chart-container">
            <h2 class="chart-title">Themes of Books Banned in 2022-2023</h2>
            <div id="treemap"></div>
        </div>
        <div class="text-container">
            <p class="section-text">
                words 
             </p>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Top 144 Books Banned in the US from July 1, 2023 to June 30, 2024</h2>
            <div id="scatterplot"></div>
        </div>
        <div class="text-container">
            <p class="section-text">
                words 
             </p>
        </div>
        <div class="context">
            <h2 class="context-title">Why Should You Care?</h2>
            <p class="context-text">
                explanation
            </p>
        </div>
        <div class="text-container">
            <h2 class="section-title">Sources</h2>
            <p class="section-text">
                https://www.ala.org/bbooks/book-ban-data <br/>
https://www.ala.org/bbooks/censorship-numbers <br/>
https://pen.org/book-bans-frequently-asked-questions/ <br/>
https://www.them.us/story/book-bans-conservative-advocacy-groups<br/>
https://pen.org/book-bans/pen-america-index-of-school-book-bans-2023-2024/<br/>
https://pen.org/report/banned-in-the-usa-state-laws-supercharge-book-suppression-in-schools/ 
             </p>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script>
        // Common tooltip setup
        const tooltip = d3.select("#tooltip");
        
        function showTooltip(event, text) {
            tooltip
                .style("opacity", 1)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 20) + "px")
                .html(text);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }

        const treemapData = {
            name: "Themes",
            children: [
                {
                    name: "Sexual Content & Profantiy",
                    children: [
                        // { name: "Violence & Physical Abuse", value: 385 },
                        { name: "Sexual Content", value: 211 },
                        { name: "Teen Pregnancy/Abortion/Sexual Assult", value: 150 }
                    ]
                },
                {
                    name: "Violence & Abuse",
                    children: [
                        { name: "Violence & Physical Abuse", value: 385 }
                    ]
                },
                {
                    name: "Death & Illness",
                    children: [
                        { name: "Health & Wellbeing for Students", value: 331 },
                        { name: "Grief/Death", value: 264 }
                    ]
                },
                {
                    name: "Sexuality/Gender",
                    children: [
                        { name: "LGBTQ+", value: 229 },
                        { name: "Transgender", value: 68 }
                    ]
                },
                {
                    name: "Race/Racism",
                    children: [
                        { name: "Race/Racism", value: 260 }
                    ]
                }
            ]
        };

        // BAR CHART
        function renderDonutChart() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margin = { top: 50, right: 50, bottom: 50, left: 50 };
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;
            const radius = Math.min(width, height) / 2.5;
            const banner = new Map();

            const svg = d3.select("#donut-chart")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            d3.csv("where-challenged.csv").then(function(data) {
                data.forEach(function(d) {
                    d.percentage = +d.percentage;
                    banner.set(d.place, d.percentage);
                });
                //console.log(banner);
                data = banner;
                //console.log(data);
                const color = d3.scaleOrdinal()
                .domain(["Public Libraries", "School Libraries", "Schools", "Higher Education/Other"])
                .range(['#1f78b4','#33a02c','#e31a1c','#fdbf6f']);

                svg.append("g")
                    .attr("class", "legendQuant")
                    .attr("transform", `translate(${470},${height/2 - 100})`);

                var legend = d3.legendColor()
                    .title("Places")
                    .scale(color)
                    .shapePadding(5);

                svg.select(".legendQuant")
                    .call(legend);

                svg.append("text")
                    .attr("x", width/2)
                    .attr("y", height - 30)
                    .attr("text-anchor", "middle")
                    .html("Data Source: <a href='https://www.ala.org/bbooks/censorship-numbers'>American Library Association</a>");

                const pie = d3.pie()
                .value(d=>d[1]);//percentage

                // adding donut
                svg.selectAll('donut')
                    .data(pie(data))
                    .join('path')
                    .attr('d', d3.arc()
                        .innerRadius(100)
                        .outerRadius(radius)
                    )
                    .attr('fill', d => color(d.data[0]))//advocates
                    .attr("stroke", "black")
                    .style("stroke-width", "1px")
                    .attr("transform", `translate(${width/2 - 180},${height/2 - 50})`)//;
                    .on("mouseover", function(event,d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.html(d.data[0] + ": " + d.data[1] + "%")
                            .attr("class", "tooltip")
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY + 10) + "px");
                        })
                    .on("mouseout", function(d) {
                        div.transition()
                        .duration(500)
                        .style("opacity", 0)});
            });
        }

        function renderDonutChart2() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margin = { top: 50, right: 50, bottom: 50, left: 50 };
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;
            const radius = Math.min(width, height) / 2.5;
            const banner = new Map();

            const svg = d3.select("#donut-chart2")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            d3.csv("who-challenges.csv").then(function(data) {
                data.forEach(function(d) {
                    d.percentage = +d.percentage;
                    banner.set(d.advocates, d.percentage);
                });
                //console.log(banner);
                data = banner;
                //console.log(data);
                const color = d3.scaleOrdinal()
                    .domain(["Board/Administration", "Pressure Groups", "Parents", "Elected Officials/Government", "Other", "Patrons", "Librarians/Teachers/Staff"])
                    .range(['#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f']);

                svg.append("g")
                    .attr("class", "legendQuant")
                    .attr("transform", `translate(${470},${height/2 - 100})`);

                var legend = d3.legendColor()
                    .title("Advocates")
                    .scale(color)
                    .shapePadding(5);

                svg.select(".legendQuant")
                    .call(legend);

                svg.append("text")
                    .attr("x", width/2)
                    .attr("y", height - 30)
                    .attr("text-anchor", "middle")
                    .html("Data Source: <a href='https://www.ala.org/bbooks/censorship-numbers'>American Library Association</a>");

                const pie = d3.pie()
                .value(d=>d[1]);//percentage

                // adding donut
                svg.selectAll('donut')
                    .data(pie(data))
                    .join('path')
                    .attr('d', d3.arc()
                        .innerRadius(100)
                        .outerRadius(radius)
                    )
                    .attr('fill', d => color(d.data[0]))//advocates
                    .attr("stroke", "black")
                    .style("stroke-width", "1px")
                    .attr("transform", `translate(${width/2 - 180},${height/2 - 50})`)//;
                    .on("mouseover", function(event,d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.html(d.data[0] + ": " + d.data[1] + "%")
                            .attr("class", "tooltip")
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY + 10) + "px");
                        })
                    .on("mouseout", function(d) {
                        div.transition()
                        .duration(500)
                        .style("opacity", 0)});
            });
        }

        // SCATTERPLOT
        function renderScatterplot() {
        const containerWidth = 900;
        const containerHeight = 550;
        const margins = { top: 20, right: 150, bottom: 100, left: 60 };
        const width = containerWidth - margins.left - margins.right;
        const height = containerHeight - margins.top - margins.bottom;

        const svg = d3.select("#scatterplot")
            .append("svg")
            .attr("width", containerWidth)
            .attr("height", containerHeight)
            .append("g")
            .attr("transform", `translate(${margins.left},${margins.top})`);

        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        d3.csv("bannedBooksThemesUpdated.csv").then(function(data) {
            data.forEach(function(d) {
                d.Times = +d.Times;
                d.NumStates = +d.NumStates;
            });

        // scale for x axis
        const x = d3
          .scaleLinear()
          .domain([0, d3.max(data.map((d) => d.Times))])
          .range([0, width]);

        // scale for y axis
        const y = d3
          .scaleLinear()
          .domain([
            0,
            d3.max(data, (d) => d.NumStates),
          ])
          .nice()
          .range([height, 0]);

        const color = d3.scaleOrdinal()
            // .domain(["Electronics", "Clothing", "Food"])
            .domain(["Sexual Content & Profantiy", "Violence & Abuse", "Race/Racism", "Sexuality/Gender", "Death & Illness", "Drugs & Alcohol", "Religion & Politics"])
            .range(["#1b9c9e",'#d95f02','#7570b3','#e7298a','#66a61e','#e6ab02','#a6761d']);//d3.schemeSet2

        console.log(Math.random())
        // svg.append("g")
        //     .attr("class", "legendQuant")
        //     .attr("transform", `translate(${100},${100})`);

        // var legend = d3.legendColor()
        //     .title("Type of Theme")
        //     .scale(color)
        //     .shapePadding(5);

        // svg.select(".legendQuant")
        //     .call(legend);

        // adding x axis
        svg.append("g")
            .attr("class", "axis axis-x")
            .attr("transform", `translate(0, ${height})`)
            .call(d3.axisBottom(x).ticks(10))
            .selectAll("text")
            .style("font-size", "11pt");

        // adding y axis
        svg.append("g")
            .attr("class", "axis axis-y")
            .call(d3.axisLeft(y).ticks(5))
            .selectAll("text")
            .style("font-size", "11pt");

        svg.append("text")
            .attr("class", "axes")
            .attr("x", width/2)
            .attr("y", 485)
            .attr("text-anchor", "middle")
            .style("font-size", "13pt")
            .text("Times Banned");

        svg.append("text")
            .attr("class", "axes")
            .attr("x", height/-2)
            .attr("y", -45)
            .attr("transform", "rotate(-90)")
            .attr("text-anchor", "middle")
            .style("font-size", "13pt")
            .text("Number of States Banned In");

        svg.append("text")
            .attr("x", 50)
            .attr("y", height + 80)
            .attr("text-anchor", "middle")
            .html("Data Source: <a href='https://pen.org/book-bans/pen-america-index-of-school-book-bans-2023-2024/'>PEN America</a>");

            // adding points
        svg.selectAll(".point")
            .data(data)
            .enter()
            .append("circle")
            .attr("class", "point")
            .attr("cx", d => x(d.Times))
            .attr("r", 7)
            .attr("cy", d => y(d.NumStates) + Math.random() + Math.random()*2)
            .style("stroke-width", "0px")
            .style("opacity", "0.6")
            //.style("fill", "#ae0c00")//;
            .attr('fill', d => color(d["Reason"]))
            .on("mouseover", function(event,d) {
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div.html(d.Title + " by " + d.Author)
                      .attr("class", "tooltip")
                     .style("left", (event.pageX + 10) + "px")
                     .style("top", (event.pageY + 10) + "px");
                })
            .on("mouseout", function(d) {
                div.transition()
                  .duration(500)
                  .style("opacity", 0);
            });

            const bubbleLegend = d3.legendColor()
                .shape("circle")
                .shapeRadius(7)
                .shapePadding(8)
                .scale(color)
                .title("Themes");

            const legend = svg.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${width-80}, 200)`)
                .call(bubbleLegend);

        });
        }

        // TREEMAP
        function renderBarChart() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margins = { top: 20, right: 50, bottom: 100, left: 150 };
            const width = containerWidth - margins.left - margins.right;
            const height = containerHeight - margins.top - margins.bottom - 20;

            const svg = d3.select("#bar-chart")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margins.left},${margins.top})`);
            
            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            d3.csv("themes.csv").then(function(data) {
                // Convert string values to numbers
            data.forEach(function(d) {
                    d["num-books"] = +d["num-books"];
                    //d["type"] = d.type;
                });
                console.log(data);

                // scale for x axis
                const x = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d["num-books"])])
                    .range([0, width]);

                // scale for y axis
                const y = d3.scaleBand()
                    .domain(data.map(d => d.theme))
                    //.nice()
                    .range([0, height])
                    .padding(0.3);

                const color = d3.scaleOrdinal()
                    .domain(["Violence and/or Sex", "Mental Health", "Identity"])
                    .range(["#6aa7df","#6d32b0","#900000","#f1ab64","#469f36"]);

                svg.append("g")
                    .attr("class", "legendQuant")
                    .attr("transform", `translate(${530},${300})`);

                var legend = d3.legendColor()
                    .title("Type of Theme")
                    .scale(color)
                    .shapePadding(5);

                svg.select(".legendQuant")
                    .call(legend);

                // adding x axis
                svg.append("g")
                    .attr("class", "axis axis-x")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x));

                // adding y axis
                svg.append("g")
                    .attr("class", "axis axis-y")
                    .call(d3.axisLeft(y).ticks(5));

                svg.append("text")
                    .attr("class", "axes")
                    .attr("x", width/2)
                    .attr("y", 510)
                    .attr("text-anchor", "middle")
                    .text("Number of Books");

                svg.append("text")
                    .attr("class", "axes")
                    .attr("x", height/-2)
                    .attr("y", -70)
                    .attr("transform", "rotate(-90)")
                    .attr("text-anchor", "middle");

                svg.append("text")
                    .attr("x", -50)
                    .attr("y", height + 50)
                    .attr("text-anchor", "middle")
                    .html("Data Source: <a href='https://pen.org/report/banned-in-the-usa-state-laws-supercharge-book-suppression-in-schools/'>PEN America</a>");

                // adding bars
                svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", 0)
                    .attr("width", d => x(d["num-books"]))
                    .attr("y", d => y(d.theme))
                    .attr("height", y.bandwidth())
                    //.style("fill", "#c71e1d");
                    .attr('fill', d => color(d["type"]))
                    .on("mouseover", function(event,d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.html(d["num-books"] + " books")
                            .attr("class", "tooltip")
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY + 10) + "px");
                        })
                    .on("mouseout", function(d) {
                        div.transition()
                        .duration(500)
                        .style("opacity", 0);
                    });;
            
            });
        }

        // TREEMAP
        function renderTreemap() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margins = { top: 20, right: 200, bottom: 100, left: 30 };
            const width = containerWidth - margins.left - margins.right;
            const height = containerHeight - margins.top - margins.bottom - 20;

            const svg = d3.select("#treemap")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margins.left},${margins.top})`);

            // Color scale for categories using ColorBrewer scheme
            const color = d3.scaleOrdinal()
                // .domain(["Electronics", "Clothing", "Food"])
                // .range(d3.schemeSet2);
                .domain(["Sexual Content & Profantiy", "Violence & Abuse", "Race/Racism", "Sexuality/Gender", "Death & Illness"])
                .range(["#1b9c9e",'#d95f02','#7570b3','#e7298a','#66a61e']);

            // Hierarchical data processing
            const root = d3.hierarchy(treemapData)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            // Create treemap layout
            d3.treemap()
                .size([width, height])
                .padding(2)
                (root);

            // Add rectangles
            svg.selectAll("rect")
                .data(root.leaves())
                .enter()
                .append("rect")
                .attr("class", "node")
                .attr("x", d => d.x0)
                .attr("y", d => d.y0)
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => d.y1 - d.y0)
                .style("fill", d => color(d.parent.data.name))
                .on("mouseover", (event, d) => {
                    showTooltip(event, `${d.parent.data.name}: ${d.data.name}<br>${d.data.value} books`);
                })
                .on("mouseout", hideTooltip);

            // Add text labels
            svg.selectAll("text")
                .data(root.leaves())
                .enter()
                .append("text")
                .attr("x", d => d.x0 + 5)
                .attr("y", d => d.y0 + 15)
                .text(d => d.data.name)
                .attr("font-size", "12px")
                .attr("fill", "white")
                .each(function(d) {
                    const node = this;
                    const textWidth = node.getComputedTextLength();
                    const boxWidth = d.x1 - d.x0;
                    
                    // Only show text if it fits
                    if (textWidth > boxWidth - 10) {
                        d3.select(this).style("opacity", 0);
                    }
                });

            // Create legend using d3-legend
            const treeLegend = d3.legendColor()
                .shape("rect")
                .shapeWidth(16)
                .shapeHeight(16)
                .shapePadding(10)
                .scale(color)
                .title("Categories");

            const legend = svg.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${width + 20}, 20)`)
                .call(treeLegend);
        }

        // Render all charts
        renderDonutChart();
        renderScatterplot();
        //renderBarChart();
        renderDonutChart2();
        renderTreemap();
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9350595ed95e15d8","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.4.0-1-g37f21b1","token":"cefab20fd71347d6a38acf95504d2fe5"}' crossorigin="anonymous"></script>
</body>
</html>