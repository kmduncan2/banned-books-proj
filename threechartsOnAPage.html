<!DOCTYPE html>
<html>
<head>
    <title>D3.js Visualizations</title>
    <style>
        /* body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        } */
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            margin-top: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 900px;
            height: 600px;
        }
        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            color: #444;
        }
        /* .bar {
            fill: steelblue;
            transition: fill 0.3s;
        }
        .bar:hover {
            fill: #ff7f0e;
        } */
        /* .axis text {
            font-size: 12px;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        } */
        .axes {
            font-size: 14px;
        }

        .axis-x path,
        .axis-y path {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .axis-x .tick line,
        .axis-y .tick line {
            stroke: #ccc;
        }

        .axis text {
            font-family: New Century Schoolbook, TeX Gyre Schola, serif;
            font-size: 12px;
        }
        .dot {
            fill: #ff7f0e;
            opacity: 0.7;
            transition: r 0.3s, opacity 0.3s;
        }
        .dot:hover {
            r: 8;
            opacity: 1;
        }
        .node {
            stroke: #fff;
            stroke-width: 1px;
            transition: opacity 0.3s;
        }
        .node:hover {
            opacity: 0.8;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            width: auto;
            height: 50px;
            padding: 2px;
            background: rgb(255, 255, 255);
            border-style: solid;
            border-width: 1px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <h1>Three Visualizations on the Same HTML page</h1>
    <div class="container">
        <div class="chart-container">
            <h2 class="chart-title">Where Books Are Banned 2024</h2>
            <div id="donut-chart"></div>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Top 144 Books Banned in the US from July 1, 2023 to June 30, 2024</h2>
            <div id="scatterplot"></div>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Themes of Books Banned in 2022-2023</h2>
            <div id="treemap"></div>
        </div>
        <div class="chart-container">
            <h2 class="chart-title">Who Bans Books 2024</h2>
            <div id="donut-chart2"></div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script>
        // Common tooltip setup
        const tooltip = d3.select("#tooltip");
        
        function showTooltip(event, text) {
            tooltip
                .style("opacity", 1)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 20) + "px")
                .html(text);
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }

        // BAR CHART
        function renderDonutChart() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margin = { top: 50, right: 50, bottom: 50, left: 50 };
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;
            const radius = Math.min(width, height) / 2.5;
            const banner = new Map();

            const svg = d3.select("#donut-chart")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            d3.csv("where-challenged.csv").then(function(data) {
                data.forEach(function(d) {
                    d.percentage = +d.percentage;
                    banner.set(d.place, d.percentage);
                });
                //console.log(banner);
                data = banner;
                //console.log(data);
                const color = d3.scaleOrdinal()
                .domain(["Public Libraries", "School Libraries", "Schools", "Higher Education/Other"])
                .range(['#1f78b4','#33a02c','#e31a1c','#fdbf6f']);

                svg.append("g")
                    .attr("class", "legendQuant")
                    .attr("transform", `translate(${470},${height/2 - 100})`);

                var legend = d3.legendColor()
                    .title("Places")
                    .scale(color)
                    .shapePadding(5);

                svg.select(".legendQuant")
                    .call(legend);

                svg.append("text")
                    .attr("x", width/2)
                    .attr("y", height - 30)
                    .attr("text-anchor", "middle")
                    .html("Data Source: <a href='https://www.ala.org/bbooks/censorship-numbers'>American Library Association</a>");

                const pie = d3.pie()
                .value(d=>d[1]);//percentage

                // adding donut
                svg.selectAll('donut')
                    .data(pie(data))
                    .join('path')
                    .attr('d', d3.arc()
                        .innerRadius(100)
                        .outerRadius(radius)
                    )
                    .attr('fill', d => color(d.data[0]))//advocates
                    .attr("stroke", "black")
                    .style("stroke-width", "1px")
                    .attr("transform", `translate(${width/2 - 180},${height/2 - 50})`)//;
                    .on("mouseover", function(event,d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.html(d.data[0] + ": " + d.data[1] + "%")
                            .attr("class", "tooltip")
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY + 10) + "px");
                        })
                    .on("mouseout", function(d) {
                        div.transition()
                        .duration(500)
                        .style("opacity", 0)});
            });
        }

        function renderDonutChart2() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margin = { top: 50, right: 50, bottom: 50, left: 50 };
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;
            const radius = Math.min(width, height) / 2.5;
            const banner = new Map();

            const svg = d3.select("#donut-chart2")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            d3.csv("who-challenges.csv").then(function(data) {
                data.forEach(function(d) {
                    d.percentage = +d.percentage;
                    banner.set(d.advocates, d.percentage);
                });
                //console.log(banner);
                data = banner;
                //console.log(data);
                const color = d3.scaleOrdinal()
                    .domain(["Board/Administration", "Pressure Groups", "Parents", "Elected Officials/Government", "Other", "Patrons", "Librarians/Teachers/Staff"])
                    .range(['#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f']);

                svg.append("g")
                    .attr("class", "legendQuant")
                    .attr("transform", `translate(${470},${height/2 - 100})`);

                var legend = d3.legendColor()
                    .title("Advocates")
                    .scale(color)
                    .shapePadding(5);

                svg.select(".legendQuant")
                    .call(legend);

                svg.append("text")
                    .attr("x", width/2)
                    .attr("y", height - 30)
                    .attr("text-anchor", "middle")
                    .html("Data Source: <a href='https://www.ala.org/bbooks/censorship-numbers'>American Library Association</a>");

                const pie = d3.pie()
                .value(d=>d[1]);//percentage

                // adding donut
                svg.selectAll('donut')
                    .data(pie(data))
                    .join('path')
                    .attr('d', d3.arc()
                        .innerRadius(100)
                        .outerRadius(radius)
                    )
                    .attr('fill', d => color(d.data[0]))//advocates
                    .attr("stroke", "black")
                    .style("stroke-width", "1px")
                    .attr("transform", `translate(${width/2 - 180},${height/2 - 50})`)//;
                    .on("mouseover", function(event,d) {
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);
                        div.html(d.data[0] + ": " + d.data[1] + "%")
                            .attr("class", "tooltip")
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY + 10) + "px");
                        })
                    .on("mouseout", function(d) {
                        div.transition()
                        .duration(500)
                        .style("opacity", 0)});
            });
        }

        // SCATTERPLOT
        function renderScatterplot() {
        const containerWidth = 900;
        const containerHeight = 500;
        const margins = { top: 20, right: 150, bottom: 50, left: 50 };
        const width = containerWidth - margins.left - margins.right;
        const height = containerHeight - margins.top - margins.bottom;

        const svg = d3.select("#scatterplot")
            .append("svg")
            .attr("width", containerWidth)
            .attr("height", containerHeight)
            .append("g")
            .attr("transform", `translate(${margins.left},${margins.top})`);

        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        d3.csv("bannedBooks.csv").then(function(data) {
            data.forEach(function(d) {
                d.Times = +d.Times;
                d.NumStates = +d.NumStates;
            });

        // scale for x axis
        const x = d3
          .scaleLinear()
          .domain([0, d3.max(data.map((d) => d.Times))])
          .range([0, width]);

        // scale for y axis
        const y = d3
          .scaleLinear()
          .domain([
            0,
            d3.max(data, (d) => d.NumStates),
          ])
          .nice()
          .range([height, 0]);

        // adding x axis
        svg.append("g")
            .attr("class", "axis axis-x")
            .attr("transform", `translate(0, ${height})`)
            .call(d3.axisBottom(x).ticks(10));

        // adding y axis
        svg.append("g")
            .attr("class", "axis axis-y")
            .call(d3.axisLeft(y).ticks(5));

        svg.append("text")
            .attr("class", "axes")
            .attr("x", width/2)
            .attr("y", 475)
            .attr("text-anchor", "middle")
            .text("Times Banned");

        svg.append("text")
            .attr("class", "axes")
            .attr("x", height/-2)
            .attr("y", -35)
            .attr("transform", "rotate(-90)")
            .attr("text-anchor", "middle")
            .text("Number of States Banned In");

            // adding points
        svg.selectAll(".point")
            .data(data)
            .enter()
            .append("circle")
            .attr("class", "point")
            .attr("cx", d => x(d.Times))
            .attr("r", 6)
            .attr("cy", d => y(d.NumStates))
            .style("stroke-width", "0px")
            .style("opacity", "0.5")
            .style("fill", "#ae0c00")//;
            .on("mouseover", function(event,d) {
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                div.html(d.Title + " by " + d.Author)
                      .attr("class", "tooltip")
                     .style("left", (event.pageX + 10) + "px")
                     .style("top", (event.pageY + 10) + "px");
                })
            .on("mouseout", function(d) {
                div.transition()
                  .duration(500)
                  .style("opacity", 0);
            });

        });
        }

        // TREEMAP
        function renderTreemap() {
            const containerWidth = 900;
            const containerHeight = 600;
            const margins = { top: 20, right: 50, bottom: 100, left: 150 };
            const width = containerWidth - margins.left - margins.right;
            const height = containerHeight - margins.top - margins.bottom - 20;

            const svg = d3.select("#treemap")
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margins.left},${margins.top})`);

            d3.csv("themes.csv").then(function(data) {
                // Convert string values to numbers
            data.forEach(function(d) {
                    d["num-books"] = +d["num-books"];
                    //d["type"] = d.type;
                });
                console.log(data);

                // scale for x axis
                const x = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d["num-books"])])
                    .range([0, width]);

                // scale for y axis
                const y = d3.scaleBand()
                    .domain(data.map(d => d.theme))
                    //.nice()
                    .range([0, height])
                    .padding(0.3);

                const color = d3.scaleOrdinal()
                    .domain(["Violence and/or Sex", "Mental Health", "Identity"])
                    .range(["#6aa7df","#6d32b0","#900000","#f1ab64","#469f36"]);

                svg.append("g")
                    .attr("class", "legendQuant")
                    .attr("transform", `translate(${530},${300})`);

                var legend = d3.legendColor()
                    .title("Type of Theme")
                    .scale(color)
                    .shapePadding(5);

                svg.select(".legendQuant")
                    .call(legend);

                // adding x axis
                svg.append("g")
                    .attr("class", "axis axis-x")
                    .attr("transform", `translate(0, ${height})`)
                    .call(d3.axisBottom(x));

                // adding y axis
                svg.append("g")
                    .attr("class", "axis axis-y")
                    .call(d3.axisLeft(y).ticks(5));

                svg.append("text")
                    .attr("class", "axes")
                    .attr("x", width/2)
                    .attr("y", 510)
                    .attr("text-anchor", "middle")
                    .text("Number of Books");

                svg.append("text")
                    .attr("class", "axes")
                    .attr("x", height/-2)
                    .attr("y", -70)
                    .attr("transform", "rotate(-90)")
                    .attr("text-anchor", "middle");

                // adding bars
                svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", 0)
                    .attr("width", d => x(d["num-books"]))
                    .attr("y", d => y(d.theme))
                    .attr("height", y.bandwidth())
                    //.style("fill", "#c71e1d");
                    .attr('fill', d => color(d["type"]));
            
            });
        }

        // Render all charts
        renderDonutChart();
        renderScatterplot();
        renderTreemap();
        renderDonutChart2();
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9350595ed95e15d8","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.4.0-1-g37f21b1","token":"cefab20fd71347d6a38acf95504d2fe5"}' crossorigin="anonymous"></script>
</body>
</html>